#!/bin/bash
set -e

targets=(
  "linux|amd64|binaries/linux_x86_64||"
  "linux|386|binaries/linux_x86_32||"
  "darwin|amd64|binaries/macosx_x86_64||"
  "linux|arm|binaries/raspberry_pi_v4|7|"
  "windows|amd64|binaries/windows_x86_64||.exe"
)

for target in "${targets[@]}"; do
  IFS='|' read -r GOOS GOARCH OUTDIR GOARM EXT <<< "$target"

  echo "Compiling for $GOOS $GOARCH ${GOARM:+(GOARM=$GOARM)}..."

  export CGO_ENABLED=0
  export GOOS GOARCH

  if [ -n "$GOARM" ]; then
    export GOARM
  else
    unset GOARM
  fi

  BIN_NAME="netinfo${EXT:-}"
  go build -ldflags="-s -w" -o "$BIN_NAME" main.go

  cp "$BIN_NAME" "$OUTDIR/"
  rm "$BIN_NAME"
done

echo "âœ… All builds completed successfully."
exit 0

